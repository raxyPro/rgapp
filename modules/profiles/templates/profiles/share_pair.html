{% extends "app_shell.html" %}
{% block content %}
{% include "profiles/_profile_styles.html" %}

<div class="profile-header">
  <h1 class="profile-title">Share CV Pair</h1>
  <p class="profile-subtitle">Manage public and private shares for this CV pair.</p>
</div>

<div class="profile-stack">
  <section class="card profile-card">
    <div class="profile-card-head">
      <div class="profile-card-title">
        <div class="profile-icon vcard"><i class="bi bi-collection"></i></div>
        <div>
          <h2>{{ pair.v_name or "vCard" }}</h2>
          <p>{{ pair.op_title or pair.v_primary_skill }}</p>
        </div>
      </div>
    </div>
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-6">
          <div class="profile-list">
            <div class="profile-row">
              <div>
                <div class="profile-row-title">Public link</div>
                <div class="profile-row-sub">Generate or refresh a public share link.</div>
              </div>
              <form method="post" action="{{ url_for('profiles.share_pair_public', cv_id=pair.cv_id) }}">
                <button class="btn btn-sm btn-outline-primary profile-btn" type="submit">Generate</button>
              </form>
            </div>
            <div class="profile-row">
              <div>
                <div class="profile-row-title">Share with user</div>
                <div class="profile-row-sub">Private share for an internal user.</div>
              </div>
              <form method="post" action="{{ url_for('profiles.share_pair_user', cv_id=pair.cv_id) }}" class="d-flex gap-2 flex-wrap">
                <select class="form-select" name="target_user_id" required>
                  <option value="">Select user</option>
                  {% for u in users %}
                    <option value="{{ u.user_id }}">{{ u.email }}</option>
                  {% endfor %}
                </select>
                <button class="btn btn-sm btn-outline-secondary profile-btn" type="submit">Share</button>
              </form>
            </div>
            <div class="profile-row">
              <div>
                <div class="profile-row-title">Share via email</div>
                <div class="profile-row-sub">Private share for an email address.</div>
              </div>
              <form method="post" action="{{ url_for('profiles.share_pair_email', cv_id=pair.cv_id) }}" class="d-flex gap-2 flex-wrap">
                <input class="form-control" name="target_email" placeholder="person@example.com" required>
                <button class="btn btn-sm btn-outline-secondary profile-btn" type="submit">Share</button>
              </form>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="profile-list">
            <div class="profile-row">
              <div>
                <div class="profile-row-title">Existing shares</div>
                <div class="profile-row-sub">Public and private shares created so far.</div>
              </div>
            </div>
            {% if public_link %}
              <div class="profile-row">
                <div>
                  <div class="profile-row-title">Public link</div>
                  <div class="small"><a href="{{ public_link }}" target="_blank">{{ public_link }}</a></div>
                </div>
              </div>
            {% endif %}
            {% if shares %}
              {% for s in shares %}
                <div class="profile-row">
                  <div>
                    <div class="profile-row-title">{{ "Public" if s.is_public else "Private" }}</div>
                    <div class="profile-row-sub">
                      {% if s.target_user_id %}User #{{ s.target_user_id }}{% elif s.target_email %}{{ s.target_email }}{% else %}Anyone with link{% endif %}
                    </div>
                    <div class="text-muted small">{{ s.created_at.strftime("%Y-%m-%d %H:%M") if s.created_at else "" }}</div>
                  </div>
                  {% if s.is_public %}
                    <a class="btn btn-sm btn-outline-secondary profile-btn" href="{{ url_for('profileviewer.view_pair', token=s.share_token) }}" target="_blank">View</a>
                  {% endif %}
                </div>
              {% endfor %}
            {% else %}
              <div class="text-muted small">No shares yet.</div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
{% endblock %}
