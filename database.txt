
Release 1 basedlined on 25-Dec-25
CREATE TABLE `rb_audit` (
  `audit_id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `event_id` char(36) NOT NULL,
  `tblname` varchar(64) NOT NULL,
  `row_id` bigint unsigned NOT NULL,
  `audit_date` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `action` enum('add','invite','register','login','edit') NOT NULL,
  `actor_id` bigint unsigned DEFAULT NULL,
  `source` enum('self','admin','api','import') NOT NULL DEFAULT 'api',
  `prev_data` json DEFAULT NULL,
  `new_data` json DEFAULT NULL,
  PRIMARY KEY (`audit_id`),
  KEY `idx_audit_tbl_row_date` (`tblname`,`row_id`,`audit_date`),
  KEY `idx_audit_event` (`event_id`),
  CONSTRAINT `chk_audit_new_json` CHECK (((`new_data` is null) or json_valid(`new_data`))),
  CONSTRAINT `chk_audit_prev_json` CHECK (((`prev_data` is null) or json_valid(`prev_data`)))
) ENGINE=InnoDB AUTO_INCREMENT=16 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;


CREATE TABLE `rb_user` (
  `user_id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `email` varchar(320) NOT NULL,
  `password_hash` varchar(255) NOT NULL,
  `status` enum('invited','active','blocked','deleted') NOT NULL DEFAULT 'invited',
  `is_admin` tinyint(1) NOT NULL DEFAULT '0',
  `requested_at` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `approved_at` datetime(6) DEFAULT NULL,
  `approved_by` bigint unsigned DEFAULT NULL,
  `blocked_at` datetime(6) DEFAULT NULL,
  `blocked_by` bigint unsigned DEFAULT NULL,
  `deleted_at` datetime(6) DEFAULT NULL,
  `deleted_by` bigint unsigned DEFAULT NULL,
  `last_login_at` datetime(6) DEFAULT NULL,
  `created_at` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `updated_at` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6),
  `invited_at` datetime DEFAULT NULL,
  `invited_by` bigint DEFAULT NULL,
  `registered_at` datetime DEFAULT NULL,
  PRIMARY KEY (`user_id`),
  UNIQUE KEY `uq_rb_user_email` (`email`),
  KEY `idx_rb_user_status` (`status`),
  KEY `idx_rb_user_requested` (`requested_at`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;


CREATE TABLE `rb_user_profile` (
  `user_id` bigint unsigned NOT NULL,
  `rgDisplay` varchar(200) NOT NULL,
  `full_name` varchar(200) DEFAULT NULL,
  `display_name` varchar(120) DEFAULT NULL,
  `rgData` json DEFAULT NULL,
  `updated_at` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6),
  PRIMARY KEY (`user_id`),
  KEY `idx_rb_profile_display` (`rgDisplay`),
  CONSTRAINT `fk_rb_profile_user` FOREIGN KEY (`user_id`) REFERENCES `rb_user` (`user_id`) ON DELETE CASCADE,
  CONSTRAINT `chk_rb_profile_rgData_json` CHECK (((`rgData` is null) or json_valid(`rgData`)))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
