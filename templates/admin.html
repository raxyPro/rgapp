{% extends "app_shell.html" %}
{% block content %}
<style>
  .admin-shell {
    background: #f4f8ff;
    border-radius: 14px;
    overflow: hidden;
    border: 1px solid #d9e2f1;
    box-shadow: 0 18px 40px rgba(35, 60, 120, 0.14);
  }
  .admin-topbar {
    background: linear-gradient(120deg, #3e6db5, #5f8fd4);
    color: #fff;
    padding: 12px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
  }
  .admin-brand {
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 700;
    font-size: 18px;
  }
  .admin-brand i {
    font-size: 20px;
  }
  .admin-nav {
    display: flex;
    align-items: center;
    gap: 16px;
    font-weight: 600;
    font-size: 13px;
  }
  .admin-nav span {
    opacity: 0.9;
    border-bottom: 2px solid transparent;
    padding-bottom: 6px;
  }
  .admin-nav .active {
    border-bottom-color: #fff;
  }
  .admin-actions {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .admin-actions .btn {
    border-radius: 8px;
    font-weight: 700;
  }
  .admin-body {
    padding: 18px 18px 20px;
  }
  .admin-filters {
    display: grid;
    grid-template-columns: 1.4fr 0.6fr 0.6fr;
    gap: 12px;
    padding: 12px;
    border: 1px solid #dbe2ee;
    border-radius: 10px;
    background: #fff;
  }
  .admin-filters input,
  .admin-filters select {
    border-radius: 8px;
  }
  .admin-table {
    background: #fff;
    border-radius: 12px;
    border: 1px solid #dbe2ee;
    margin-top: 14px;
    overflow: hidden;
  }
  .admin-table table {
    margin: 0;
  }
  .admin-table th {
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    color: #4a6288;
    background: #f3f6fb;
  }
  .status-pill {
    display: inline-flex;
    align-items: center;
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 12px;
    font-weight: 700;
    color: #fff;
  }
  .status-active { background: #4caf6e; }
  .status-invited { background: #f0ad4e; }
  .status-inactive { background: #e16666; }
  .role-pill {
    font-size: 12px;
    font-weight: 700;
    color: #3b5b92;
  }
  .icon-action {
    width: 30px;
    height: 30px;
    border-radius: 8px;
    border: 1px solid #d3dbea;
    background: #fff;
    color: #3e5f8f;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }
  .icon-action.warn { color: #f0ad4e; border-color: #f5d7a7; }
  .icon-action.danger { color: #e16666; border-color: #efb1b1; }
  .admin-footer {
    padding: 12px 16px;
    border-top: 1px solid #e3e9f3;
    font-size: 12px;
    color: #5a6f8a;
    background: #f8fafd;
  }
  @media (max-width: 960px) {
    .admin-topbar {
      flex-wrap: wrap;
      justify-content: flex-start;
    }
    .admin-nav { width: 100%; }
    .admin-actions { width: 100%; justify-content: flex-start; }
    .admin-filters { grid-template-columns: 1fr; }
  }
</style>

<div class="admin-shell">
  <div class="admin-topbar">
    <div class="admin-brand">
      <i class="bi bi-bridge"></i>
      RayGrow Bridge
    </div>
    <div class="admin-nav">
      <span class="active">Dashboard</span>
      <span>Users</span>
      <span>Settings</span>
      <span>Reports</span>
    </div>
    <div class="admin-actions">
      <a class="btn btn-outline-light btn-sm" href="{{ url_for('admin.view_log') }}">View Logs</a>
      <a class="btn btn-light btn-sm" href="/admin/invite">Add User</a>
    </div>
  </div>

  <div class="admin-body">
    <div class="admin-filters">
      <input class="form-control" placeholder="Search users...">
      <select class="form-select">
        <option>Status</option>
        <option>Active</option>
        <option>Invited</option>
        <option>Inactive</option>
      </select>
      <select class="form-select">
        <option>Role</option>
        <option>Admin</option>
        <option>User</option>
      </select>
    </div>

    <div class="admin-table">
      <table class="table table-sm mb-0">
        <thead>
          <tr>
            <th>Email</th>
            <th>Status</th>
            <th>Role</th>
            <th>Registered</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for u in users %}
          <tr>
            <td>{{ u.email }}</td>
            <td>
              {% if u.status == 'active' %}
                <span class="status-pill status-active">Active</span>
              {% elif u.status == 'invited' %}
                <span class="status-pill status-invited">Invited</span>
              {% else %}
                <span class="status-pill status-inactive">Inactive</span>
              {% endif %}
            </td>
            <td><span class="role-pill">{{ "Admin" if u.is_admin else "User" }}</span></td>
            <td>{{ u.registered_at or "" }}</td>
            <td class="d-flex gap-2 flex-wrap">
              <a class="icon-action" href="/admin/modules/{{ u.user_id }}" title="Assign modules" aria-label="Assign modules"><i class="bi bi-gear"></i></a>
              <a class="icon-action warn" href="{{ url_for('admin.edit_user', user_id=u.user_id) }}" title="Edit" aria-label="Edit"><i class="bi bi-pencil"></i></a>
              {% if u.status != "active" %}
                <form method="post" action="{{ url_for('admin.send_invite', user_id=u.user_id) }}">
                  <button class="icon-action" type="submit" title="Send invite" aria-label="Send invite"><i class="bi bi-envelope"></i></button>
                </form>
              {% endif %}
              <form method="post" action="{{ url_for('admin.deactivate_user', user_id=u.user_id) }}" onsubmit="return confirm('Make {{u.email}} inactive?');">
                <button class="icon-action danger" type="submit" title="Deactivate" aria-label="Deactivate"><i class="bi bi-x-lg"></i></button>
              </form>
              {% if u.status == "active" %}
              <form method="post" action="/admin/reset/{{ u.user_id }}">
                <button class="icon-action" type="submit" title="Reset password" aria-label="Reset password"
                        onclick="return confirm('Send password reset link to {{u.email}}?');">
                  <i class="bi bi-key"></i>
                </button>
              </form>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="admin-footer">
      Showing {{ users|length }} entries
    </div>
  </div>
</div>
{% endblock %}
